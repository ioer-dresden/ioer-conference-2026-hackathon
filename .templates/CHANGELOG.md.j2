# CHANGELOG

{# 
  Mapping of conventional commit types to human-friendly section headers.
  If a type is not in this dictionary, it will fall back to the default type (Angular).
  Example: 
    - "code style" → "Style" (allows using the "style:"-prefix more broadly)
    - "feat" → "Features"
    - Unknown types like "improve" → "Improve"
#}

{% set type_labels = {
    "feat": "Features",
    "fix": "Bug fixes",
    "refactor": "Refactoring",
    "style": "Style",
    "code style": "Style",
    "test": "Tests",
    "chore": "Chores",
    "docs": "Documentation",
    "perf": "Performance",
    "build": "Build",
    "ci": "Continuous integration"
} %}

{% if context.history.unreleased | length > 0 %}
## Unreleased
{% for type_, commits in context.history.unreleased | dictsort if type_ != "unknown" %} {# Removed leading hyphen #}
### {{ type_labels.get(type_, type_ | capitalize) }}
{% for commit in commits if type_ != "unknown" %} {# Removed leading hyphen #}
{#
   Replacing commit.subject with the first line of the raw message.
   Keeping the capitalize filter as it was on the commit.subject line.
#}
{% if commit.scope %}
- **{{ commit.scope }}**: {{ commit.message.split('\n')[0].split(':', 1) | last | trim | capitalize }} ([`{{ commit.short_hash }}`]({{ commit.hexsha | commit_hash_url }}))
{% else %}
- {{ commit.message.split('\n')[0].split(':', 1) | last | trim | capitalize }} ([`{{ commit.short_hash }}`]({{ commit.hexsha | commit_hash_url }}))
{% endif %}
{#
   Removed the block that iterated through commit.descriptions[1:] (the rest of the body)
   {%- if commit.descriptions | length > 1 %}
     {%- for description in commit.descriptions[1:] %}
       - {{ description }}
     {%- endfor %}
   {%- endif %}
#}
{#
   Removed the block that rendered breaking changes from the body footer
   {%- if commit.breaking_descriptions | length > 0 %}
       **BREAKING CHANGES:** {{ commit.breaking_descriptions | join(" ") }}
   {%- endif %}
#}
{% endfor %} {# Removed leading hyphen #}
{% endfor %} {# Removed leading hyphen #}
{% endif %}

{% for version, release in context.history.released.items() %} {# Removed trailing hyphen #}
## {{ version.as_semver_tag() }} ({{ release.tagged_date.strftime("%Y-%m-%d") }})
{% for type_, commits in release["elements"] | dictsort if type_ != "unknown" %} {# Removed leading hyphen #}
### {{ type_labels.get(type_, type_ | capitalize) }}
{% for commit in commits if type_ != "unknown" %} {# Removed leading hyphen #}
{#
   Replacing commit.subject with the first line of the raw message.
   Keeping the capitalize filter as it was on the commit.subject line.
#}
{% if commit.scope %}
- **{{ commit.scope }}**: {{ commit.message.split('\n')[0].split(':', 1) | last | trim | capitalize }} ([`{{ commit.short_hash }}`]({{ commit.hexsha | commit_hash_url }}))
{% else %}
- {{ commit.message.split('\n')[0].split(':', 1) | last | trim | capitalize }} ([`{{ commit.short_hash }}`]({{ commit.hexsha | commit_hash_url }}))
{% endif %}
{#
   Removed the block that iterated through commit.descriptions[1:] (the rest of the body)
   {%- if commit.descriptions | length > 1 %}
     {%- for description in commit.descriptions[1:] %}
       - {{ description }}
     {%- endfor %}
   {%- endif %}
#}
{#
   Removed the block that rendered breaking changes from the body footer
   {%- if commit.breaking_descriptions | length > 0 %}
       **BREAKING CHANGES:** {{ commit.breaking_descriptions | join(" ") }}
   {%- endif %}
#}
{% endfor %} {# Removed leading hyphen #}
{% endfor %} {# Removed leading hyphen #}
{%- if "breaking" in release["elements"] %} {# Keeping leading hyphen on this block for layout control #}
### BREAKING CHANGES
{%- for type_, commits in release["elements"] | dictsort if type_ == "breaking" %}
{% for commit in commits %} {# Removed leading hyphen #}
{#
   Original template used commit.breaking_descriptions.
   We replace it with the first line of the raw message.
   Prepending "BREAKING CHANGE:" for clarity for this type.
   Not capitalizing the first line here, consistent with the original template's handling of breaking changes.
#}
{% if commit.scope %} {# Removed trailing hyphen #}
- **{{ commit.scope }}**: BREAKING CHANGE: {{ commit.message.split('\n')[0] }} ([`{{ commit.short_hash }}`]({{ commit.hexsha | commit_hash_url }})) {# Added hash/link back here for breaking changes #}
{% else %} {# Removed trailing hyphen #}
- BREAKING CHANGE: {{ commit.message.split('\n')[0] }} ([`{{ commit.short_hash }}`]({{ commit.hexsha | commit_hash_url }})) {# Added hash/link back here for breaking changes #}
{% endif %}
{% endfor %} {# Removed leading hyphen #}
{% endfor %} {# Removed leading hyphen #}
{% endif %}
{% endfor %}
